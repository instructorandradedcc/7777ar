<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Experiencias AR</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- A-Frame (includes Three.js r158) -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    
    <!-- MindAR for A-Frame -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <!-- Three.js via Import Maps for the 3D editor -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
            }
        }
    </script>
    
    <style>
        .page { display: none; }
        .page.active { display: block; }
        #editor-canvas { width: 100%; height: 400px; border: 1px solid #ccc; background: #f0f0f0; cursor: move; }
        #ar-scene-container.ar-active {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9990;
        }
        #ar-active-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 9999;
        }
        /* Loader styles */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-200 text-gray-800 font-sans">

    <div id="app" class="container mx-auto p-6 md:p-8 max-w-5xl bg-white rounded-xl shadow-lg my-8 overflow-y-auto" style="max-height: 85vh;">
        <!-- HEADER -->
        <div class="flex justify-center items-center mb-6">
             <img src="logofundacion.jpg" alt="Logo Fundación" class="h-20 mr-4" onerror="this.onerror=null;this.src='https://placehold.co/80x80/e2e8f0/94a3b8?text=Logo';">
            <div>
                <h1 class="text-3xl font-bold text-center text-indigo-600">Creador de Experiencias AR</h1>
                <p class="text-center text-gray-500">Un nuevo flujo de trabajo para usar tus propias imágenes.</p>
            </div>
        </div>

        <!-- PAGE 1: Load Assets -->
        <div id="page-upload" class="page active bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Paso 1: Cargar Recursos</h2>
            <div class="bg-indigo-50 border-l-4 border-indigo-500 text-indigo-700 p-4 mb-6" role="alert">
                <p class="font-bold">¡Bienvenido!</p>
                <p>Presiona el botón para descargar y preparar los modelos 3D, los marcadores y las imágenes desde el repositorio oficial. Los archivos se guardarán en la caché de tu navegador para acelerar futuras cargas.</p>
            </div>
            
            <div class="mt-6 text-center">
                <button id="load-from-github-btn" class="bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition duration-300 text-lg shadow-md">
                    Cargar Recursos desde GitHub
                </button>
            </div>

            <div id="loading-status" class="mt-6 hidden">
                <div class="flex justify-center items-center">
                    <div class="loader"></div>
                </div>
                <p id="loading-text" class="text-center text-gray-600 mt-2">Iniciando...</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                    <div id="loading-progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>
            
            <div id="image-preview-container" class="mt-6"></div>

             <div class="mt-8 text-center">
                <button id="goto-editor-btn" disabled class="bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-600 transition duration-300 disabled:bg-gray-300 mt-2">Siguiente: Editar Modelos 3D</button>
            </div>
        </div>

        <!-- PAGE 2: 3D Editor -->
        <div id="page-editor" class="page bg-white p-6 rounded-lg shadow-md">
             <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Paso 2: Ajustar Modelos 3D</h2>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/3">
                    <label for="asset-selector" class="block mb-2 font-medium text-gray-700">Seleccionar Recurso:</label>
                    <select id="asset-selector" class="w-full p-2 border rounded mb-4"></select>
                    
                    <h3 class="font-semibold mt-4">Posición (X, Y, Z)</h3>
                    <div class="grid grid-cols-3 gap-2">
                        <input type="number" id="pos-x" class="w-full p-1 border rounded" step="0.01" value="0">
                        <input type="number" id="pos-y" class="w-full p-1 border rounded" step="0.01" value="0">
                        <input type="number" id="pos-z" class="w-full p-1 border rounded" step="0.01" value="0">
                    </div>

                    <h3 class="font-semibold mt-4">Rotación (X, Y, Z)</h3>
                     <div class="grid grid-cols-3 gap-2">
                        <input type="number" id="rot-x" class="w-full p-1 border rounded" step="1" value="0">
                        <input type="number" id="rot-y" class="w-full p-1 border rounded" step="1" value="0">
                        <input type="number" id="rot-z" class="w-full p-1 border rounded" step="1" value="0">
                    </div>

                    <h3 class="font-semibold mt-4">Escala</h3>
                    <input type="number" id="scale" class="w-full p-1 border rounded" step="0.1" value="1">
                </div>
                <div class="md:w-2/3">
                    <div id="editor-container"><canvas id="editor-canvas"></canvas></div>
                </div>
            </div>
            <div class="mt-6 flex justify-between">
                <button id="back-to-upload-btn" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-300">Atrás</button>
                <button id="goto-ar-btn" class="bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-600 transition duration-300">Siguiente: Probar AR</button>
            </div>
        </div>

        <!-- PAGE 3: AR Camera -->
        <div id="page-ar" class="page">
             <div class="relative">
                <div id="ar-ui-container" class="relative z-10">
                    <h2 class="text-2xl font-semibold mb-4 text-center">Paso 3: Vista de Realidad Aumentada</h2>
                    <div class="bg-white p-4 rounded-lg shadow-md mb-4">
                        <p class="text-center">Apunta tu cámara a una de las imágenes de los marcadores. <strong>Puedes girar el modelo 3D deslizando el dedo sobre la pantalla.</strong></p>
                        <div id="ar-status" class="text-center font-mono p-2 bg-gray-100 rounded mt-2 flex justify-center items-center gap-2">
                            <span id="ar-status-text">Estado: Listo para activar la cámara.</span>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-between items-center">
                        <button id="back-to-editor-btn-pre" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-300">Atrás</button>
                        <button id="start-ar-btn" class="bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition duration-300">Activar Cámara AR</button>
                    </div>
                </div>
                <!-- Container for AR Scene -->
                <div id="ar-scene-container"></div>
                <div id="ar-active-controls" class="hidden p-4 bg-black bg-opacity-50">
                    <div class="flex justify-center items-center max-w-4xl mx-auto">
                        <button id="stop-ar-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 transition duration-300">Detener Cámara</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { DragControls } from 'three/addons/controls/DragControls.js';

    document.addEventListener('DOMContentLoaded', () => {
        // --- GLOBAL STATE & VARIABLES ---
        const state = {
            assets: [],
            currentPage: 'page-upload',
            isArActive: false,
        };

        let editor = {
            scene: null, camera: null, renderer: null, controls: null, dragControls: null,
            loader: new GLTFLoader(),
            textureLoader: new THREE.TextureLoader(),
            currentTarget: null,
            currentPlane: null,
        };
        
        const CACHE_NAME = 'ar-assets-cache-v1';
        const GITHUB_BASE_URL = 'https://raw.githubusercontent.com/instructorandradedcc/7777ar/main/asetss/';
        const ASSET_NAMES = [
            'botellytaazul', 'ecoladrillo', 'lataplateada', 
            'papelitoverde', 'senorcontenedor', 'taparoja'
        ];

        // --- CUSTOM A-FRAME COMPONENTS ---

        // Component to handle touch rotation of the model
        AFRAME.registerComponent('touch-rotator', {
            schema: {
                rotationFactor: { type: 'number', default: 2 }
            },
            init: function () {
                this.targetEntity = this.el.parentEl; // The mindar-image-target
                this.isVisible = false;
                this.isDragging = false;
                this.previousDragX = 0;
                this.previousDragY = 0;

                const canvas = this.el.sceneEl.canvas;
                canvas.addEventListener('touchstart', this.onTouchStart.bind(this));
                canvas.addEventListener('touchmove', this.onTouchMove.bind(this));
                canvas.addEventListener('touchend', this.onTouchEnd.bind(this));
                
                this.targetEntity.addEventListener('targetFound', () => { this.isVisible = true; });
                this.targetEntity.addEventListener('targetLost', () => { this.isVisible = false; });
            },
            onTouchStart: function(e) {
                if (e.touches.length === 1 && this.isVisible) {
                    this.isDragging = true;
                    this.previousDragX = e.touches[0].clientX;
                    this.previousDragY = e.touches[0].clientY;
                }
            },
            onTouchMove: function(e) {
                if (this.isDragging && e.touches.length === 1 && this.isVisible) {
                    const deltaX = e.touches[0].clientX - this.previousDragX;
                    const deltaY = e.touches[0].clientY - this.previousDragY;

                    const rotation = this.el.object3D.rotation;
                    rotation.y += THREE.MathUtils.degToRad(deltaX * this.data.rotationFactor);
                    rotation.x += THREE.MathUtils.degToRad(deltaY * this.data.rotationFactor);

                    this.previousDragX = e.touches[0].clientX;
                    this.previousDragY = e.touches[0].clientY;
                }
            },
            onTouchEnd: function() {
                this.isDragging = false;
            }
        });


        // --- APP FUNCTIONS ---

        // Fetches a URL, using cache if available.
        async function fetchWithCache(url) {
            try {
                const cache = await caches.open(CACHE_NAME);
                const cachedResponse = await cache.match(url);
                if (cachedResponse) {
                    console.log('Serving from cache:', url);
                    return cachedResponse;
                }
                console.log('Fetching from network:', url);
                const networkResponse = await fetch(url);
                if (networkResponse.ok) {
                    await cache.put(url, networkResponse.clone());
                }
                return networkResponse;
            } catch (error) {
                console.error(`Failed to fetch ${url}:`, error);
                throw error;
            }
        }
        
        function displayLoadedImages(assets) {
            const container = document.getElementById('image-preview-container');
            container.innerHTML = `<h3 class="text-lg font-semibold mb-2 text-center">Imágenes de Marcadores Cargadas</h3>`;
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4';
            assets.forEach(asset => {
                const img = document.createElement('img');
                img.src = asset.imageDataUrl;
                img.className = 'w-full h-auto object-cover rounded-lg shadow-md';
                img.title = asset.imageName;
                grid.appendChild(img);
            });
            container.appendChild(grid);
        }

        // Loads all assets from GitHub
        async function loadAssetsFromGitHub() {
            const loadingStatusDiv = document.getElementById('loading-status');
            const loadingText = document.getElementById('loading-text');
            const progressBar = document.getElementById('loading-progress-bar');
            
            loadingStatusDiv.classList.remove('hidden');
            document.getElementById('load-from-github-btn').disabled = true;

            const totalAssets = ASSET_NAMES.length * 3; // .mind, .glb, and .jpg for each
            let loadedCount = 0;
            
            const promises = ASSET_NAMES.map(async (name, index) => {
                const markerUrl = `${GITHUB_BASE_URL}markers/${name}.mind`;
                const modelUrl = `${GITHUB_BASE_URL}modelss/${name}.glb`;
                const imageUrl = `${GITHUB_BASE_URL}imagenes/${name}.jpg`;

                // Fetch marker
                const markerResponse = await fetchWithCache(markerUrl);
                const markerBlob = await markerResponse.blob();
                loadedCount++;
                progressBar.style.width = `${(loadedCount / totalAssets) * 100}%`;
                loadingText.textContent = `Cargando ${name}.mind...`;

                // Fetch model
                const modelResponse = await fetchWithCache(modelUrl);
                const modelBlob = await modelResponse.blob();
                loadedCount++;
                progressBar.style.width = `${(loadedCount / totalAssets) * 100}%`;
                loadingText.textContent = `Cargando ${name}.glb...`;
                
                // Fetch image
                const imageResponse = await fetchWithCache(imageUrl);
                const imageBlob = await imageResponse.blob();
                loadedCount++;
                progressBar.style.width = `${(loadedCount / totalAssets) * 100}%`;
                loadingText.textContent = `Cargando ${name}.jpg...`;

                return {
                    id: index,
                    markerDataUrl: URL.createObjectURL(markerBlob),
                    markerName: `${name}.mind`,
                    modelDataUrl: URL.createObjectURL(modelBlob),
                    modelName: `${name}.glb`,
                    imageDataUrl: URL.createObjectURL(imageBlob),
                    imageName: `${name}.jpg`,
                    transform: { position: { x: 0, y: 0, z: 0 }, rotation: { x: 0, y: 0, z: 0 }, scale: { x: 1, y: 1, z: 1 } },
                    hasBeenNormalized: false,
                    normalizationFactor: 1,
                };
            });

            try {
                state.assets = await Promise.all(promises);
                loadingText.textContent = '¡Todos los recursos cargados y guardados en caché!';
                displayLoadedImages(state.assets);
                document.getElementById('goto-editor-btn').disabled = false;
            } catch (error) {
                loadingText.textContent = 'Error al cargar los recursos. Revisa la consola para más detalles.';
                progressBar.classList.add('bg-red-600');
            }
        }
        
        function initEditor() {
            const canvas = document.getElementById('editor-canvas');
            const container = document.getElementById('editor-container');
            if (!canvas || !container || editor.renderer) return;

            editor.scene = new THREE.Scene();
            editor.scene.background = new THREE.Color(0xeeeeee);
            editor.camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            editor.camera.position.set(0, 1, 15);

            const ambientLight = new THREE.AmbientLight(0xffffff, 2);
            editor.scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 3);
            directionalLight.position.set(2, 5, 3);
            editor.scene.add(directionalLight);
            
            editor.renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            editor.renderer.setSize(container.clientWidth, container.clientHeight);
            editor.renderer.setPixelRatio(window.devicePixelRatio);

            editor.controls = new OrbitControls(editor.camera, editor.renderer.domElement);
            editor.controls.enableDamping = true;

            function animate() { 
                requestAnimationFrame(animate); 
                editor.controls.update(); 
                editor.renderer.render(editor.scene, editor.camera); 
            }
            animate();
        }

        function populateEditorSelector() {
            const assetSelector = document.getElementById('asset-selector');
            assetSelector.innerHTML = '';
            state.assets.forEach(asset => {
                const option = document.createElement('option');
                option.value = asset.id;
                option.textContent = `${asset.modelName}`;
                assetSelector.appendChild(option);
            });
        }

        function updateTransformInputs(transform) {
            document.getElementById('pos-x').value = transform.position.x.toFixed(2);
            document.getElementById('pos-y').value = transform.position.y.toFixed(2);
            document.getElementById('pos-z').value = transform.position.z.toFixed(2);
            document.getElementById('rot-x').value = Math.round(transform.rotation.x);
            document.getElementById('rot-y').value = Math.round(transform.rotation.y);
            document.getElementById('rot-z').value = Math.round(transform.rotation.z);
            document.getElementById('scale').value = transform.scale.x.toFixed(2);
        }

        function displayAssetInEditor(assetId) {
            const asset = state.assets.find(a => a.id === assetId);
            if (!asset || !editor.scene) return;
            
            if (editor.currentTarget) editor.scene.remove(editor.currentTarget);
            if (editor.currentPlane) editor.scene.remove(editor.currentPlane);
            if (editor.dragControls) editor.dragControls.dispose();
            
            editor.textureLoader.load(asset.imageDataUrl, (texture) => {
                const aspect = texture.image.width / texture.image.height;
                const planeWidth = 10;
                const planeHeight = planeWidth / aspect;
                const planeGeom = new THREE.PlaneGeometry(planeWidth, planeHeight);
                const planeMat = new THREE.MeshBasicMaterial({ map: texture });
                editor.currentPlane = new THREE.Mesh(planeGeom, planeMat);
                editor.currentPlane.position.set(0, 0, -0.1);
                editor.scene.add(editor.currentPlane);
            });

            editor.loader.load(asset.modelDataUrl, (gltf) => {
                editor.currentTarget = gltf.scene;
                
                if (!asset.hasBeenNormalized) {
                    const box = new THREE.Box3().setFromObject(editor.currentTarget);
                    const size = box.getSize(new THREE.Vector3());
                    const center = box.getCenter(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    asset.normalizationFactor = 5.0 / maxDim; // Normalize to a size of 5 units
                    editor.currentTarget.position.sub(center);
                    asset.transform.position = { x: 0, y: 0, z: 0 };
                    asset.transform.rotation = { x: 0, y: 0, z: 0 };
                    asset.transform.scale = { x: 1, y: 1, z: 1 };
                    asset.hasBeenNormalized = true;
                }
                
                editor.scene.add(editor.currentTarget);
                updateModelTransformFromState(asset.transform);
                updateTransformInputs(asset.transform);
                setupDragControls(editor.currentTarget);
            }, undefined, (error) => console.error("Error loading model:", error));
        }
            
        function updateModelTransformFromState(transform) {
            if (!editor.currentTarget) return;
            const assetId = parseInt(document.getElementById('asset-selector').value);
            const asset = state.assets.find(a => a.id === assetId);
            if (!asset || !asset.normalizationFactor) return;

            const finalScale = transform.scale.x * asset.normalizationFactor;
            
            editor.currentTarget.position.set(transform.position.x, transform.position.y, transform.position.z);
            editor.currentTarget.rotation.set(
                THREE.MathUtils.degToRad(transform.rotation.x),
                THREE.MathUtils.degToRad(transform.rotation.y),
                THREE.MathUtils.degToRad(transform.rotation.z)
            );
            editor.currentTarget.scale.set(finalScale, finalScale, finalScale);
        }

        function setupDragControls(object) {
            editor.dragControls = new DragControls([object], editor.camera, editor.renderer.domElement);
            editor.dragControls.addEventListener('dragstart', () => editor.controls.enabled = false);
            editor.dragControls.addEventListener('dragend', (event) => {
                editor.controls.enabled = true;
                const assetId = parseInt(document.getElementById('asset-selector').value);
                const asset = state.assets.find(a => a.id === assetId);
                if (asset) {
                    const newPos = event.object.position;
                    asset.transform.position.x = newPos.x;
                    asset.transform.position.y = newPos.y;
                    asset.transform.position.z = newPos.z;
                    updateTransformInputs(asset.transform);
                }
            });
        }
        
        function startAR() {
            const arSceneContainer = document.getElementById('ar-scene-container');
            arSceneContainer.innerHTML = '';
            const mindARSettings = `imageTargetSrc: ${state.assets.map(a => a.markerDataUrl).join(';')}; autoStart: true; uiLoading: no; uiError: no; uiScanning: no;`;
            
            const sceneEl = document.createElement('a-scene');
            sceneEl.setAttribute('mindar-image', mindARSettings);
            sceneEl.setAttribute('color-space', 'sRGB');
            sceneEl.setAttribute('renderer', 'colorManagement: true, physicallyCorrectLights');
            sceneEl.setAttribute('vr-mode-ui', 'enabled: false');
            sceneEl.setAttribute('device-orientation-permission-ui', 'enabled: false');
            
            const cameraEl = document.createElement('a-camera');
            cameraEl.setAttribute('position', '0 0 0');
            cameraEl.setAttribute('look-controls', 'enabled: false');
            sceneEl.appendChild(cameraEl);

            state.assets.forEach((asset, index) => {
                const targetEl = document.createElement('a-entity');
                targetEl.setAttribute('mindar-image-target', `targetIndex: ${index}`);
                
                const t = asset.transform;
                const finalScale = asset.normalizationFactor * t.scale.x;

                const modelEntity = document.createElement('a-gltf-model');
                modelEntity.setAttribute('src', asset.modelDataUrl);
                modelEntity.setAttribute('position', `${t.position.x} ${t.position.y} ${t.position.z}`);
                modelEntity.setAttribute('rotation', `${t.rotation.x} ${t.rotation.y} ${t.rotation.z}`);
                modelEntity.setAttribute('scale', `${finalScale} ${finalScale} ${finalScale}`);
                modelEntity.setAttribute('touch-rotator', '');
                
                targetEl.appendChild(modelEntity);
                sceneEl.appendChild(targetEl);
            });

            arSceneContainer.appendChild(sceneEl);
            arSceneContainer.classList.add('ar-active');
            document.getElementById('ar-ui-container').classList.add('hidden');
            document.getElementById('ar-active-controls').classList.remove('hidden');
            state.isArActive = true;
        }

        function stopAR() {
            const arSceneContainer = document.getElementById('ar-scene-container');
            const sceneEl = arSceneContainer.querySelector('a-scene');
            if (sceneEl && sceneEl.hasLoaded) {
                 if (sceneEl.systems['mindar-image']) {
                    sceneEl.systems['mindar-image'].stop();
                }
                sceneEl.parentNode.removeChild(sceneEl);
            }
            arSceneContainer.innerHTML = '';
            
            arSceneContainer.classList.remove('ar-active');
            document.getElementById('ar-ui-container').classList.remove('hidden');
            document.getElementById('ar-active-controls').classList.add('hidden');
            state.isArActive = false;
        }
        
        function navigateTo(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            state.currentPage = pageId;

            if (pageId === 'page-editor' && !editor.renderer) initEditor();
            
            if (pageId === 'page-editor') {
                populateEditorSelector();
                if (state.assets.length > 0) {
                     displayAssetInEditor(parseInt(document.getElementById('asset-selector').value) || state.assets[0].id);
                }
            }
            if (pageId !== 'page-ar' && state.isArActive) stopAR();
        }

        // --- INITIALIZATION & EVENT LISTENERS ---
        
        document.getElementById('load-from-github-btn').addEventListener('click', loadAssetsFromGitHub);
        
        // Navigation
        document.getElementById('goto-editor-btn').addEventListener('click', () => navigateTo('page-editor'));
        document.getElementById('goto-ar-btn').addEventListener('click', () => navigateTo('page-ar'));
        document.getElementById('back-to-upload-btn').addEventListener('click', () => navigateTo('page-upload'));
        document.getElementById('back-to-editor-btn-pre').addEventListener('click', () => navigateTo('page-editor'));
        document.getElementById('start-ar-btn').addEventListener('click', startAR);
        document.getElementById('stop-ar-btn').addEventListener('click', stopAR);

        // Editor logic
        const assetSelector = document.getElementById('asset-selector');
        assetSelector.addEventListener('change', (e) => displayAssetInEditor(parseInt(e.target.value)));
        
        const transformInputs = ['pos-x', 'pos-y', 'pos-z', 'rot-x', 'rot-y', 'rot-z', 'scale'];
        transformInputs.forEach(id => {
            document.getElementById(id).addEventListener('input', () => {
                const assetId = parseInt(assetSelector.value);
                const asset = state.assets.find(a => a.id === assetId);
                if (!asset || !editor.currentTarget) return;
                
                asset.transform.position = { x: parseFloat(document.getElementById('pos-x').value), y: parseFloat(document.getElementById('pos-y').value), z: parseFloat(document.getElementById('pos-z').value) };
                asset.transform.rotation = { x: parseFloat(document.getElementById('rot-x').value), y: parseFloat(document.getElementById('rot-y').value), z: parseFloat(document.getElementById('rot-z').value) };
                const scaleVal = parseFloat(document.getElementById('scale').value);
                asset.transform.scale = { x: scaleVal, y: scaleVal, z: scaleVal };
                
                updateModelTransformFromState(asset.transform);
            });
        });
    });
    </script>
</body>
</html>
